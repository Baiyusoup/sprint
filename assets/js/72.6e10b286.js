(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{591:function(s,a,t){"use strict";t.r(a);var e=t(6),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[s._v("#")]),s._v(" 概念")]),s._v(" "),t("p",[s._v("移除JavaScript上下文中的未引用代码，依赖于ES6模块静态结构特性，就是在编译阶段就能够确认模块依赖关系。")]),s._v(" "),t("h2",{attrs:{id:"webpack中使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webpack中使用"}},[s._v("#")]),s._v(" webpack中使用")]),s._v(" "),t("p",[s._v("在webpack4中，通过package.json中的“sideEffects”属性作为标记，想解析器compiler提供提示，表明项目中的哪些文件是es6模块的，可以安全地删除文件中未使用的部分。")]),s._v(" "),t("p",[s._v("如果说我们的项目所有代码都不包含副作用，那么我们可以将“sideEffects”字段标记为false，告诉webpack，可以安全地删除为用到的export导出。")]),s._v(" "),t("p",[s._v("副作用是在导入时会执行特殊行为的代码，而且不是仅仅暴露一个或多个export。想pofyy")]),s._v(" "),t("p",[s._v("死代码和活代码的例子：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" cube "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'math.js'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doSomething")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("导入并赋值给js对象，cube在doSomething中被用到，被webpack视为活代码。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" cube "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'math'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("doSomething")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("cube被导入并且赋值给js对象，但是并没有被使用到，会被webpack视为死代码。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'math'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// do something")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("整体导入，但是没有赋值给js对象，也没有被用到，会被当做死代码。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'the-lib'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// do")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("导入整个库，也没有赋值给js对象，也没有被用到，但是会被当做活代码，因为webpack对库的导入和本地代码的导入的处理的方式不同。")]),s._v(" "),t("h2",{attrs:{id:"使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),t("p",[s._v("为了能够顺利进行tree shaking")]),s._v(" "),t("ol",[t("li",[s._v("使用es6的模块")]),s._v(" "),t("li",[s._v("确保webpack等工具不会把es6模块转变为commonjs")]),s._v(" "),t("li",[s._v("在package.json文件中，添加sideEffects属性")]),s._v(" "),t("li",[s._v("使用生产模式")])]),s._v(" "),t("h2",{attrs:{id:"优化方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化方式"}},[s._v("#")]),s._v(" 优化方式")]),s._v(" "),t("ol",[t("li",[s._v("sideEffects")]),s._v(" "),t("li",[s._v("usedExports")])]),s._v(" "),t("p",[s._v("相对来说第一种更有效，因为它允许跳过整个模块、文件或整个文件子树。usedExports依赖terser去检测语句中的副作用。")]),s._v(" "),t("h2",{attrs:{id:"commonjs无法进行tree-shaking原因"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#commonjs无法进行tree-shaking原因"}},[s._v("#")]),s._v(" commonjs无法进行tree shaking原因")]),s._v(" "),t("p",[s._v("commonjs的require导入方式是动态的，因此无法确定在实际允许前需要或者不需要某些模块。而ES6的模块采用的是完全静态的导入语法，可以在代码不运行的情况下就能够分析出不需要的代码。")])])}),[],!1,null,null,null);a.default=r.exports}}]);