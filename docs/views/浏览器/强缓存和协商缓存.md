---
title: 强缓存和协商缓存
date: 2021-07-12
categories: 
 - 浏览器
---

## 强缓存
浏览器在请求某一个资源的时候，会先获取该资源先前缓存的Header信息，然后根据Header里面的Cache-Control和Expires这两个头字段来判断该资源是否已经过期，如果没有过期，那么浏览器只需要从缓存中获取该资源即可，不需要向服务器发起请求；如果过期的话，就需要向服务器发起请求（协商缓存阶段）

优先级上是Cache-Control高于Expires，原因在于Expires的值是一个绝对时间的字符串，如果客户端时间和服务器时间相差较大，缓存命中与否就不是开发者所期望的。Cache-Control是一个时间段，控制就比较容易

## 协商缓存
浏览器向服务器发起Http请求，这个请求会携带第一次请求该资源时所缓存的Header信息，服务端会根据Header里面的信息，来告诉浏览器进一步的操作是什么。

服务端检查请求的Header信息时，会检测If-Modified-Since这个头字段的值，这个值是第一次请求该资源时响应报文头`Last-Modified的值，服务端会比对这个请求头字段的值和服务端所保存的这个资源的最后修改时间，如果一致，那么就返回204状态码和空的响应体，告诉浏览器可以使用本地缓存的资源。如果不一致，就说明资源已更新了，服务端返回新的资源。

此外还会检测请求头的If-None-Match，这个字段的值是服务端上一次返回的响应头ETag的值，如果这个值与现在服务端保存的ETag一致，那么就只需要返回304状态码和空响应体；如果不一致，就返回新的资源以及新的ETag。

优先级上是If-None-Match高于If-Modified-Since，原因在于Last-Modified的单位值秒，无法体现出毫秒级别的变化。
