---
title: 模块化方案
date: 2021-07-13
categories: 
 - JavaScript
---

## 介绍
模块是将一个复杂的程序依据一定的规范封装成几个文件，并进行组合在一起。文件内部的数据与实现是私有的，只是向外部暴露一些接口与外部其他模块通信。

## 好处
1. 代码抽象
2. 代码封装
3. 代码复用
4. 依赖管理

## CommonJs
commonjs模块规范是用于服务端，使用require指定依赖，exports对象定义自己的公共api。它的特点是
1. 所有代码都运在模块作用域中，不会污染全局作用域
2. 模块是同步加载的
3. 模块在首次执行后就会缓存，再次记载只返回缓存的结果
4. require关键字返回的值是被输出的值的拷贝，模块内部的变化不会影响到这个已经输出的值

## AMD
AMD模块规范是异步加载模块，以浏览器作为目标执行环境，所有依赖模块的语句都定义在一个回调函数中，等所有模块都加载完了，这个回调函数才会执行。

## ESM
ES6模块的设计思想是尽量的静态化，使得在编译阶段就能够确认模块的依赖关系，以及输入和输出的变量。

ES6模块的独特之处在于既可以通过浏览器原生加载，也可以与第三方加载器和构建工具一起加载。完全支持ES6模块的浏览器可以从顶级模块加载整个依赖图，而且是异步完成的。浏览器会解析入口模块，确定依赖，并发送对依赖模块的请求。这些文件通过网络请求返回后，浏览器就会解析它们的内容，确定它们的依赖，如果这些二级依赖还没加载，则会发送更多的请求。这个异步递归加载过程会持续到整个应用程序的依赖图完成。解析完依赖图后，应用程序就可以正式加载这些模块。

ES6模块是按需加载的，而且后续模块的请求会因为每个依赖模块的网络延迟而同步延迟。

ES6模块的部分特点
1. 模块中可以导入导出各种类型的变量
2. 模块是单例的，而且是加载一次
3. 模块默认是严格模式
4. 模块可以请求加载其他模块