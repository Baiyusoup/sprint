---
title: 浏览器的工作原理
date: 2021-08-01
categories: 
 - 浏览器
---

## DNS查找
[GO](../计算机网络/DNS查询过程.md)

## TCP握手
[GO](../计算机网络/三握四挥.md)

## TLS协商
[GO](../计算机网络/https.md)

## 请求-响应

## 渲染
### 构建DOM树
字节->字符->令牌->节点->DOM

### 样式计算
渲染引擎收到CSS文本数据后，进行格式化，标准化，生成一个styleSheets对象，然后计算每个节点具体的样式信息。计算的规则是依据继承和层叠，每个子节点都会去继承父节点的样式，如果父节点中没有，就采用浏览器的默认样式。计算完样式之后，所有的样式值都会被挂载到window.getComputedStyle当中。

### 布局阶段
完成的DOM树和样式计算后，通过浏览器的布局系统确定元素位置，生成一个布局树（Layout Tree）。大概来说就是遍历DOM树可见节点，将这些可见节点加到布局树中，然后计算布局树中节点的坐标位置。

### 分层
生成布局树后，还需要根据布局树创建图层树。浏览器的页面实际上被分成了很多图层，这些图层叠加后合成了最终的页面，一般情况下，并非布局树的每个节点都包含一个图层，如果一个节点没有对应的层，那么这个节点就从属于父节点的图层。但是对于一些特殊的节点，会被放到一个单独的合成层。

`显示合成`：
1. 拥有层叠上下文的节点
2. 需要剪裁的地方的节点

`隐式合成`：
一个z-index比较低的节点被提升为单独图层后，层叠在它上面的元素都会被提升为单独的图层。

### 绘制
完成图层的构建后，开始对图层拆分成一个个绘制指令，然后再按照这些指令的顺序组成一个绘制列表。

### 分块
绘制列表完成后，渲染进程将列表提交给合成线程，让它来做事。有时候，有的图层很大，但是通过视口，用户只看到页面的很小的一部分，在这种情况下，合成线程会将这类图层划分为一块块图块(tile)。

### 光栅化
有了图块之后，合成线程会按照视口附近的图块优先生成位图，

### 合成
栅格化操作完成后，合成线程就发送绘制的指令给浏览器进程，让浏览器进程中的相关组件将根据指令进行页面的绘制，然后发送到显卡，由显卡来负责发送到显示器显示


https://time.geekbang.org/column/article/118205