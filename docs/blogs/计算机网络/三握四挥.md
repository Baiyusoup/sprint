---
title: 三次握手与四次挥手
date: 2021-07-12
categories: 
 - 计算机网络
---

## 三次握手
##### 第一次握手
浏览器向服务器发出连接请求报文段，这时首部的同步位SYN值1，初始序号seq=x，然后客户端进入同步以发送状态。

第一次握手确认了浏览器的发送能力、服务端的接收能力。
##### 第二次握手
服务端同意建立连接，向客户端发送确认报文，报文首部的同步位SYN和确认位ACK都置1，确认号ack=x+1，初始序号seq=y。这时服务端进入同步已确认状态。

第二次握手确认了浏览器和服务器的接收和发送的能力，但是服务器不确定浏览器的接收能力。
##### 第三次握手
客户端收到服务端的确认报文后，向服务端发出确认报文，报文首部的确认位ACK置1，确认号ack=y+1，序号seq=x+1，客户端进入已建立连接状态，服务端收到确认报文后也进入已建立连接状态，这时候TCP连接建立成功。

TCP的标准规定，这次握手的ACK确认报文可以携带数据，但如果不携带数据则不会消耗序号，在这种情况下，下一个数据报文段的序号seq仍是x+1.

第三次握手确定了双方都确定了对方的能力。

## 四次挥手
##### 第一次挥手
客户端向服务端发送释放连接报文，并主动停止再发送数据，主动关闭TCP连接，这个连接释放报文首部的中止位FIN设置1，序号seq=u，这时客户端进入终止等待1状态。

##### 第二次挥手
服务端收到连接释放报文后，向客户端立即发出确认报文，报文首部的确认位ACK置1，确认号ack=u+1，序号seq=w，这时候服务端进入关闭等待状态。客户端收到确认报文后也进入终止等待2状态。

##### 第三次挥手
服务端已经没有要向客户端发送的数据了，然后就发送连接释放报文，报文首部的中止位FIN，确认位ACK都置1，确认号ack=u+1，序号seq=w。这时候服务端进入最后确认状态。

##### 第四次挥手
客户端收到服务端发过来的连接释放报文后，向服务端发送确认报文，报文首部的确认位ACK=1，确认号ack=w+1，序号seq=u+1，之后客户端进入时间等待状态
